```{r load-data}
library(tidyverse)
landings <- read_csv("~/Desktop/landings.csv")
view(landings)
```

```{r clean-df}
landings <- landings %>%
  subset(select = -c(...7:...34)) %>%
  rename(year = YEAR) %>%
  rename(port = "PORT NAME") %>%
  rename(state = STATE) %>%
  rename(sp_name = SPPNAME) %>%
  rename(landed_lbs = "LANDED LBS") %>%
  rename(live_lbs = "LIVE LBS")
```
```{r filter-year}
landings <- landings %>%
  filter(year >= 1995)
```

```{r numeric-lbs}
###convert the landings data to numeric values

landings$landed_lbs <- gsub(",", "", landings$landed_lbs)
landings$landed_lbs <- as.integer(landings$landed_lbs)

landings$live_lbs <- gsub(",", "", landings$live_lbs)
landings$live_lbs <- as.integer(landings$live_lbs)

str(landings)
```
```{r lobster-landings}
###lobster ONLY landings by year and state --> for visualization
lobster_landings <- landings %>%
  filter(sp_name == "LOBSTER, AMERICAN") %>%
  group_by(year, state) %>%
  summarise(lobster_lbs = sum(landed_lbs))
```


```{r total-landings}
###total landings by port and year
total_landings <- landings %>%
  filter(port != "CONFIDENTIAL") %>%
  group_by(port, year) %>%
  summarise(total_lbs = sum(landed_lbs)) %>%
  view()
```

```{r lobster-viz}
lobster_landings %>%
  ggplot(aes(x = year, y = lobster_lbs, color = state)) +
  geom_line() +
  labs(
    title = "Landed Pounds of American Lobster in New England, 1995-2021",
    x = "Year",
    y = "Landed Pounds",
    color = "State"
  )
```

```{r conf-species}
conf <- landings %>%
  select(year, port, landed_lbs, sp_name, state) %>%
  filter(port != "CONFIDENTIAL", sp_name == "CONFIDENTIAL") %>%
  group_by(port, year, state) %>%
  summarise(conf_landings = sum(landed_lbs)) %>%
  view()
```

```{r conf-viz}
###Create tibble with ports by year with majority confidential landings
conf_ratio <- merge(x = conf, y = total_landings, all = TRUE) %>%
  group_by(port, year) %>%
  mutate(conf_annual_ratio = conf_landings / total_lbs) %>%
  arrange(desc(conf_annual_ratio)) %>%
  filter(conf_annual_ratio >= 0.50) %>%
  view()

###Need to determine what the cutoff count of majority confidential occurrences is -- 6?  
conf_viz <- conf_ratio %>%
  group_by(port) %>%
  mutate(conf_count = n_distinct(year)) %>%
  ggplot(aes(x = port, y = conf_count)) +
  geom_point() +
  labs(
    title = "Total Years with >= 0.50 Confidential Landed Pounds in the Northeastern U.S.",
    x = "Port",
    y = "Count"
  )

conf_viz +facet_wrap(~state)
```

```{r viable-ports}
###Tibble with list of ports by year whose confidential landings are not majority
###Use cutoff count to filter for viable ports

merge(x = conf, y = total_landings, all = TRUE) %>%
  group_by(port, year) %>%
  mutate(conf_annual_ratio = conf_landings / total_lbs) %>%
  arrange(desc(conf_annual_ratio)) %>%
  filter(conf_annual_ratio < 0.50) %>%
  view()
```




