```{r load-data}
library(tidyverse)
landings <- read_csv("~/Desktop/landings.csv")
view(landings)
```

```{r clean-df}
landings <- landings %>%
  subset(select = -c(...7:...34)) %>%
  rename(year = YEAR) %>%
  rename(port = "PORT NAME") %>%
  rename(state = STATE) %>%
  rename(sp_name = SPPNAME) %>%
  rename(landed_lbs = "LANDED LBS") %>%
  rename(live_lbs = "LIVE LBS")
```
```{r filter-year}
landings <- landings %>%
  filter(year >= 1995)
```

```{r numeric-lbs}
landings$landed_lbs <- gsub(",", "", landings$landed_lbs)
landings$landed_lbs <- as.integer(landings$landed_lbs)

landings$live_lbs <- gsub(",", "", landings$live_lbs)
landings$live_lbs <- as.integer(landings$live_lbs)

str(landings)
```
```{r lobster-landings}
lobster_landings <- landings %>%
  filter(sp_name == "LOBSTER, AMERICAN") %>%
  group_by(year, state) %>%
  summarise(lobster_lbs = sum(landed_lbs))
```


```{r total-landings}
total_landings <- landings %>%
  filter(port != "CONFIDENTIAL") %>%
  group_by(port, year) %>%
  summarise(total_lbs = sum(landed_lbs)) %>%
  view()
```

```{r first-viz}
lobster_landings %>%
  ggplot(aes(x = year, y = lobster_lbs, color = state)) +
  geom_line() +
  labs(
    title = "Landed Pounds of American Lobster in New England, 1995-2021",
    x = "Year",
    y = "Landed Pounds",
    color = "State"
  )
```

{r better-viz}
lobster_landings <- lobster_landings %>%
  select(year, state, lobster_lbs) %>%
  group_by(state) %>%
  mutate(previous_year = lag(lobster_lbs, order_by = year)) %>%
  view()

lobster_landings %>%
  group_by(state) %>%
  mutate(pChange = ((lobster_lbs - previous_year)/previous_year) * 100) %>%
  ggplot(aes(x = year, y = pChange, color = state)) +
  geom_line() +
  labs(
    title = "Landed Pounds of American Lobster in New England, 1995-2021",
    x = "Year",
    y = "Landed Pounds",
    color = "State"
  )
```{r confidential}
conf <- landings %>%
  select(year, port, landed_lbs, sp_name, state) %>%
  filter(port != "CONFIDENTIAL", sp_name == "CONFIDENTIAL") %>%
  group_by(port, year, state) %>%
  summarise(conf_landings = sum(landed_lbs)) %>%
  view()
```
```{r comm-viz}
conf_ratio <- merge(x = conf, y = total_landings, all = TRUE) %>%
  group_by(port, year) %>%
  mutate(conf_annual_ratio = conf_landings / total_lbs) %>%
  arrange(desc(conf_annual_ratio)) %>%
  filter(conf_annual_ratio >= 0.50) %>%
  view()

  
conf_viz <- conf_ratio %>%
  group_by(port) %>%
  mutate(conf_count = n_distinct(year)) %>%
  ggplot(aes(x = port, y = conf_count)) +
  geom_point() +
  labs(
    title = "Total Years with >= 0.50 Confidential Landed Pounds in the Northeastern U.S.",
    x = "Port",
    y = "Count"
  )

conf_viz +facet_wrap(~state)
```



